# Changelog

Все значимые изменения в проекте документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект следует [Semantic Versioning](https://semver.org/lang/ru/).

## [Unreleased]


## [0.3.2] - 2026-01-03

### Добавлено
- Поддержка форматов вывода и сохранения в файл для команды `vk:check`
  - Опция `--format` для выбора формата: `table`, `json`, `csv`, `markdown` (по умолчанию `table`)
  - Опция `--output` для сохранения результатов в файл
  - Автоматическое определение формата по расширению файла (`.json`, `.csv`, `.md`, `.markdown`)
  - Поддержка Markdown формата с форматированными таблицами
  - CSV файлы содержат BOM для корректного отображения кириллицы в Excel
- Unit и Feature тесты для команды `vk:check`
  - Тесты форматирования (JSON, CSV, Markdown)
  - Тесты сохранения в файл
  - Тесты автоматического определения формата
  - Тесты валидации параметров
  - Тесты работы с кешем и экспортом

## [0.3.1] - 2026-01-03

### Добавлено
- Поддержка Markdown формата для отчетов в команде `vk:analytics`
  - Автоматическое определение Markdown формата при указании расширения `.md` или `.markdown` в `--output`
  - Форматированные таблицы с корректной разметкой
  - Отображение названия группы вместо ID в заголовке отчета
  - Ссылки на посты в таблицах топ-постов
- Переменная окружения `VK_ANALYTICS_TIMEZONE` для настройки таймзоны аналитики по умолчанию
  - Приоритет: опция `--timezone` > `VK_ANALYTICS_TIMEZONE` из `.env` > `APP_TIMEZONE` > UTC
  - Рекомендуется для российских групп: `VK_ANALYTICS_TIMEZONE=Europe/Moscow`

### Изменено
- Улучшен алгоритм определения лучшего времени публикации в `vk:analytics`
  - Теперь учитывается не только средний ER, но и количество постов для статистической значимости
  - Рекомендации: ⭐ Лучшее (топ-1), ⭐ Хорошее (топ-2-3 с ER ≥ 80% от лучшего), ⚠️ Среднее (остальные)
- Улучшено форматирование Markdown отчетов
  - Исправлено дублирование колонок в таблицах топ-постов
  - Исправлены переносы строк в метаданных (владелец, период, подписчики)
  - Убраны переносы строк из текста постов для корректного отображения таблиц
- Обновлен `.env.example` с добавлением всех переменных окружения, включая `VK_ANALYTICS_TIMEZONE`

### Документация
- Добавлена формула Engagement Rate (ER) в начало документации `docs/analytics.md`
  - Подробное объяснение формулы с примером расчета
  - Добавлено предупреждение об ограничении точности ER для старых постов
  - Объяснение, что используется текущее количество подписчиков, что может искажать ER для постов старше 3-6 месяцев
- Расширен раздел "Интерпретация результатов" с деталями расчета ER и ограничениями
- Добавлено правило в `.cursor/rules` для автоматического обновления `.env.example` при изменении переменных окружения

## [0.3.0] - 2026-01-03

### Добавлено
- Команда `vk:analytics` для углубленного анализа эффективности постов группы/пользователя VK
  - Расчет Engagement Rate (ER) и общих метрик (лайки, репосты, комментарии)
  - Анализ ER по дням недели для определения оптимальных дней публикации
  - Определение лучшего времени публикации (анализ по часам с минимум 3 постами)
  - Топ-посты по метрикам: ER, лайки, репосты, комментарии
  - Сравнение с предыдущим периодом с визуализацией трендов (⬆️/➡️/⬇️)
  - Поддержка периодов: week, month, quarter, year или произвольный диапазон
  - Фильтрация по минимальной вовлеченности
  - Форматы вывода: table, JSON, CSV (с несколькими файлами)
  - Сохранение результатов в файл
  - Progress bar для больших периодов
  - Кеширование количества подписчиков на 1 час
- Расширение `VkGroupService::getById()` для поддержки параметра `fields` (получение `members_count`)
- Миграция для добавления составного индекса `(owner_id, date)` в таблицу `vk_posts` для оптимизации запросов
- Unit и Feature тесты для команды `vk:analytics`
  - Тесты расчета ER, группировки по дням/часам
  - Тесты топ-постов и сравнения периодов
  - Тесты форматирования (JSON, CSV)
  - Тесты сохранения в файл

### Изменено
- Оптимизированы запросы к БД в команде `vk:analytics` с использованием составного индекса

### Документация
- Добавлено описание команды `vk:analytics` в `docs/commands.md`
- Создан отдельный документ `docs/analytics.md` с подробным руководством:
  - Quick Start с пошаговыми инструкциями
  - Подробное описание всех анализируемых метрик
  - Примеры использования для разных сценариев
  - Интерпретация результатов
  - Разделы по автоматизации, визуализации и бенчмаркам
- Добавлены примеры использования аналитики в `docs/examples.md`
- Обновлен `README.md` с упоминанием аналитики и ссылкой на документацию
- Обновлен `CHANGELOG.md`

## [0.2.4] - 2026-01-03

### Изменено
- Опция `--clear` в команде `vk:posts-get` теперь очищает только посты указанного владельца (`--owner`), а не всю таблицу
  - Это позволяет работать с несколькими группами одновременно, очищая данные только для конкретного владельца
  - Посты других владельцев остаются нетронутыми при использовании `--clear`

### Добавлено
- Unit тесты для опций `--clear` и `--update` в команде `vk:posts-get`
  - Тест `test_clear_removes_only_specified_owner_posts` - проверяет, что очистка работает только для указанного владельца
  - Тест `test_update_updates_existing_posts` - проверяет обновление существующих записей
  - Тест `test_update_adds_new_and_updates_existing_posts` - проверяет одновременное обновление и добавление постов
- Примеры использования в документации (`docs/examples.md`)
  - Примеры работы с опциями `--update` и `--clear`
  - Новый раздел "Работа с несколькими группами одновременно" с практическими примерами

### Исправлено
- Исправлена логика очистки базы данных: `clearDatabase()` теперь вызывается в начале метода `handle()` перед получением постов из API

## [0.2.3] - 2026-01-02

### Добавлено
- Команда `vk:albums-get` для получения списка фотоальбомов пользователя или сообщества VK
  - Поддержка получения системных альбомов (с отрицательными ID)
  - Получение обложек альбомов (опция `--need-covers`)
  - Фильтрация по минимальному количеству фотографий в альбоме
  - Форматы вывода: table, JSON, CSV
  - Сохранение результатов в файл
- Сервис `VkPhotoService` для работы с VK Photo API
  - Метод `getAlbums()` для получения альбомов с параметрами
  - Метод `getAllAlbums()` для получения всех альбомов с пагинацией
- Unit тесты для новой функциональности
  - Тесты для `VkPhotoService` (пагинация, обработка параметров, обложки)
  - Тесты для форматирования вывода в команде `GetAlbums` (JSON, CSV)
  - Mock тесты для команды `GetAlbums` (валидация, фильтрация, обработка ошибок)

## [0.2.2] - 2026-01-02

### Добавлено
- Команда `vk:posts-get` для получения постов группы/пользователя за указанный период
  - Поддержка фильтрации по дате, наличию текста, минимальному количеству лайков и репостов
  - Форматы вывода: table, JSON, CSV
  - Опция `--db` для сохранения постов в SQLite базу данных
  - Автоматическое определение формата сохранения по расширению файла
- Миграция для таблицы `vk_posts` в базе данных
- Makefile с командами для установки и работы с проектом
  - `make setup` - полная настройка проекта
  - `make install` - установка зависимостей
  - `make migrate` - запуск миграций
  - `make vk-check` - проверка постов в группах
  - `make vk-groups-info` - информация о группах
- Автоматическое создание файла `resources/vk-groups.csv` при `make setup`
- Улучшенная обработка ошибок при отсутствии файла `vk-groups.csv`
- Структура документации в папке `docs/`
- CHANGELOG.md для отслеживания изменений
- Бейджи технологий в README

### Изменено
- Переименована команда `vk:hallo` в `vk:groups-info` для лучшей понятности
- Переименованы команды для единообразия: `vk:groups:info` → `vk:groups-info`, `vk:posts:get` → `vk:posts-get`
- Файл конфигурации групп переименован: `resources.csv` → `vk-groups.csv`
- Файл конфигурации групп перемещен: `storage/app/vk-groups.csv` → `resources/vk-groups.csv`
- Обновлен Laravel с версии 8.x до 9.x для совместимости с PHP 8.1+
- Обновлены требования к PHP: теперь требуется PHP 8.1+ (рекомендуется 8.2+)
- Улучшена обработка ошибок в модели `Resource`:
  - Проверка существования файла перед чтением
  - Понятные сообщения об ошибках с инструкциями
  - Фильтрация комментариев (строк, начинающихся с `#`)
- README.md реорганизован: детальная документация перенесена в папку `docs/`

### Исправлено
- Исправлена обработка пустых файлов при сохранении результатов
- Исправлена обработка отсутствующего файла `vk-groups.csv` (теперь выводится понятное сообщение вместо TypeError)

### Технические изменения
- Добавлена миграция `2024_01_01_000000_create_vk_posts_table.php`
- Обновлен `.gitignore` для исключения пользовательских конфигурационных файлов
- Обновлена документация: README.md упрощен, детали перенесены в `docs/`

## [0.1.0] - 2026-01-02

### Добавлено
- Базовый функционал работы с VK API
- Команды для работы с группами и постами
- Конфигурация через `.env` файл

